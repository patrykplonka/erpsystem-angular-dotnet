<div class="orders-container">
  <div class="dashboard-container">
    <app-sidebar (navigate)="navigateTo($event)" (logoutEvent)="logout()"></app-sidebar>
    <main class="main-content">
      <header>
        <div>
          <h1>Zamówienia</h1>
          <p>Zarządzaj zamówieniami w systemie</p>
        </div>
        <div class="user-info">
          <p>Zalogowany jako: <strong>{{ currentUserEmail || 'Brak danych użytkownika' }}</strong></p>
        </div>
      </header>
      <section class="orders-section">
        <div class="messages">
          <div class="alert alert-success" *ngIf="successMessage">{{ successMessage }}</div>
          <div class="alert alert-danger" *ngIf="errorMessage">{{ errorMessage }}</div>
        </div>
        <div class="orders-list">
          <div class="list-controls">
            <button class="add-button" [routerLink]="['/orders/new']">Dodaj zamówienie</button>
            <button class="toggle-deleted" (click)="toggleDeletedView()">
              {{ showDeleted ? "Pokaż aktywne" : "Pokaż usunięte" }}
            </button>
          </div>
          <div class="advanced-filters">
            <select [(ngModel)]="filterStatus" (ngModelChange)="loadOrders()">
              <option value="">Wszystkie statusy</option>
              <option value="Pending">Oczekujące</option>
              <option value="Confirmed">Potwierdzone</option>
              <option value="Completed">Zrealizowane</option>
            </select>
            <select [(ngModel)]="filterType" (ngModelChange)="loadOrders()">
              <option value="">Wszystkie typy</option>
              <option value="Purchase">Zakup</option>
              <option value="Sale">Sprzedaż</option>
            </select>
          </div>
          <table>
            <thead>
              <tr>
                <th (click)="sortBy('orderNumber')">Numer <span *ngIf="sortField === 'orderNumber'" [class.asc]="sortDirection === 'asc'">▼</span></th>
                <th (click)="sortBy('contractorName')">Kontrahent <span *ngIf="sortField === 'contractorName'" [class.asc]="sortDirection === 'asc'">▼</span></th>
                <th (click)="sortBy('orderType')">Typ <span *ngIf="sortField === 'orderType'" [class.asc]="sortDirection === 'asc'">▼</span></th>
                <th (click)="sortBy('orderDate')">Data <span *ngIf="sortField === 'orderDate'" [class.asc]="sortDirection === 'asc'">▼</span></th>
                <th (click)="sortBy('totalAmount')">Kwota <span *ngIf="sortField === 'totalAmount'" [class.asc]="sortDirection === 'asc'">▼</span></th>
                <th (click)="sortBy('status')">Status <span *ngIf="sortField === 'status'" [class.asc]="sortDirection === 'asc'">▼</span></th>
                <th>Akcje</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let order of filteredOrders">
                <td data-label="Numer">{{ order.orderNumber }}</td>
                <td data-label="Kontrahent">{{ order.contractorName }}</td>
                <td data-label="Typ">{{ order.orderType }}</td>
                <td data-label="Data">{{ order.orderDate | date:'yyyy-MM-dd' }}</td>
                <td data-label="Kwota">{{ order.totalAmount | currency:'PLN' }}</td>
                <td data-label="Status">{{ order.status }}</td>
                <td data-label="Akcje" class="actions">
                  <button *ngIf="!showDeleted && order.status === 'Pending'" class="action-button confirm-button" (click)="confirmOrder(order.id)">Potwierdź</button>
                  <a *ngIf="!showDeleted" [routerLink]="['/orders/edit', order.id]" class="action-button edit-button">Edytuj</a>
                  <button *ngIf="!showDeleted" class="action-button delete-button" (click)="deleteOrder(order.id)">Usuń</button>
                  <button *ngIf="showDeleted" class="action-button restore-button" (click)="restoreOrder(order.id)">Przywróć</button>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="no-orders" *ngIf="!isLoading && filteredOrders.length === 0">
            Brak zamówień do wyświetlenia.
          </div>
          <div class="pagination" *ngIf="totalPages > 1">
            <button (click)="changePage(page - 1)" [disabled]="page === 1">Poprzednia</button>
            <span>Strona {{ page }} z {{ totalPages }}</span>
            <button (click)="changePage(page + 1)" [disabled]="page >= totalPages">Następna</button>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>
